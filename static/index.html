<!doctype html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>PI Radio</title>

	<link rel="stylesheet" href="index.css" />
</head>

<body>
	<main>
		<h1>PI Radio</h1>

		<ul id="audio-file-list"></ul>

		<button id="stop-button">Stop</button>
		<button id="pause-button">Pause</button>
		<button id="volume-button">Volume</button>

		<form id="upload-form" enctype="multipart/form-data">
			<input type="file" id="file-input" name="files" multiple>
			<button type="submit">Upload</button>
		</form>
	</main>
</body>

</html>

<template id="audio-file">
	<li>
		<div class="audio-file-name"></div>
		<button class="audio-file-play-button">Play</button>
	</li>
</template>

<script>
	const audioFileList = document.getElementById('audio-file-list');
	const audioFileTemplate = document.getElementById('audio-file');
	const stopButton = document.getElementById('stop-button')
	const pauseButton = document.getElementById('pause-button')
	const volumeButton = document.getElementById('volume-button')
	const uploadForm = document.getElementById('upload-form')

	fetch('/api/radio/files')
		.then(response => response.json())
		.then(data => {
			data.forEach(file => {
				const clone = audioFileTemplate.content.cloneNode(true);

				clone.querySelector('.audio-file-name').textContent = file.name;

				clone.querySelector('.audio-file-play-button').addEventListener('click', () => {
					fetch(`/api/radio/play`, { method: 'POST', body: JSON.stringify({ audio_file_id: file.id }) })
				})

				audioFileList.appendChild(clone);
			});
		})
		.catch(error => console.error('Error fetching data:', error))

	stopButton.addEventListener('click', () => {
		fetch('/api/radio/stop', { method: 'POST' })
	})

	pauseButton.addEventListener('click', () => {
		fetch('/api/radio/pause', { method: 'POST', body: JSON.stringify({ paused: true }) })
	})

	volumeButton.addEventListener('click', () => {
		fetch('/api/radio/volume', { method: 'POST', body: JSON.stringify({ volume: 0 }) })
	})

	uploadForm.addEventListener('submit', async (event) => {
		event.preventDefault()

		const fileInput = document.getElementById('file-input')
		const files = fileInput.files

		if (files.length === 0) {
			return
		}

		const formData = new FormData();

		for (let i = 0; i < files.length; i++) {
			formData.append('files', files[i])
		}


		const response = await fetch('/api/radio/files', { method: 'POST', body: formData })
		if (response.ok) {
			const data = await response.json()
			location.reload()
		}
	})
</script>